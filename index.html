<!doctype html>

<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>لعبة مريم — نسخة تعليمية</title>
  <style>
    :root{--bg:#0b0f12;--card:#0f1720;--accent:#e85d5d;--text:#e6eef6}
    html,body{height:100%;margin:0;font-family:Tahoma,Arial,system-ui,Segoe UI,sans-serif;background:linear-gradient(180deg,#051018 0%,#08121a 60%);color:var(--text)}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:20px}
    .card{width:100%;max-width:760px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.06));border-radius:12px;padding:20px;box-shadow:0 10px 40px rgba(2,6,23,0.7);border:1px solid rgba(255,255,255,0.03)}
    header{display:flex;align-items:center;gap:14px}
    .avatar{width:96px;height:96px;border-radius:12px;background:linear-gradient(180deg,#222 0%,#111 100%);display:flex;align-items:center;justify-content:center;font-size:46px}
    h1{margin:0;font-size:20px}
    p.lead{margin:6px 0 12px;color:#bcd3ea}
    .dialog{background:rgba(255,255,255,0.02);padding:16px;border-radius:10px;min-height:220px;display:flex;flex-direction:column;gap:10px}
    .line{padding:10px 12px;border-radius:8px;max-width:85%;}
    .line.mariam{background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));align-self:flex-start}
    .line.player{background:rgba(255,255,255,0.02);align-self:flex-end}
    .choices{display:flex;flex-wrap:wrap;gap:8px;margin-top:auto}
    button.choice{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px 14px;border-radius:8px;color:var(--text);cursor:pointer}
    button.choice:hover{border-color:var(--accent)}
    footer{margin-top:12px;display:flex;gap:8px;align-items:center}
    .hint{color:#9fb6d4;font-size:13px}
    .meta{margin-left:auto;color:#9fb6d4;font-size:13px}
    .hidden{display:none}
    /* small responsive */
    @media (max-width:480px){.avatar{width:72px;height:72px;font-size:34px}.dialog{min-height:180px}}
  </style>
</head>
<body>
  <!--
    ملف تعليمي: "لعبة مريم" — نسخة مبسطة قابلة للتشغيل داخل المتصفح.
    كيفية الاستخدام:
     - احفظ هذا الملف باسم maryam.html وافتحه في المتصفح.
     - اللعبة تستخدم localStorage لحفظ التقدّم.
     - تكشف اللعبة محتوى جديدًا كل يوم (يُحاكى عبر فاصل 24 ساعة)، لكن يمكنك اختبار التقدّم بتعديل "FAKE_NEXT_DAY" داخل الكود إلى true.
    ملاحظات تطويرية:
     - هذا الملف قصدي تعليمي — تجنّب إضافة أكواد ضارة أو تحميل من مصادر غير موثوقة.
  -->
  <div class="wrap">
    <div class="card" role="application" aria-label="لعبة مريم التعليمية">
      <header>
        <div class="avatar">م</div>
        <div>
          <h1>لعبة مريم — نسخة تعليمية</h1>
          <p class="lead">حوار تفاعلي بسيط بالعربية. كل يوم تكشف مريم قطعة من قصّتها.</p>
          <div class="meta">نسخة تعليمية — لا تجمع بيانات خارج الجهاز</div>
        </div>
      </header><main style="margin-top:14px">
    <div id="dialog" class="dialog" aria-live="polite"></div>

    <div id="choices" class="choices"></div>

    <footer>
      <div class="hint">نصيحة: حاول اختيار إجابات مختلفة لتكشف فروعًا متعددة.</div>
      <div class="meta" id="progress"></div>
    </footer>
  </main>
</div>

  </div>  <script>
    // إعداد القصة: مصفوفة من الأيام. كل يوم يحتوي على مجموعة من الأسطر وأسئلة.
    const STORY = [
      {
        day:1,
        lines:[
          "...",
          "أنا مريم. هل ستساعدني؟",
          "لقد ضعت في الغابة."
        ],
        choices:[
          {id:'c1', text:'نعم، سأساعدك.'},
          {id:'c2', text:'من أنت؟'}
        ]
      },
      {
        day:2,
        lines:[
          "اليوم يبدو مختلفًا.",
          "أسمع أصواتًا، لكن لا أحد يرد عليّ."
        ],
        choices:[
          {id:'c3', text:'ما الذي حدث لك؟'},
          {id:'c4', text:'هل أنت خائفة؟'}
        ]
      },
      {
        day:3,
        lines:[
          "أحيانًا أتذكّر أبوابًا تُغلَق...",
          "وقالوا لي: لا تخرجي وحدك."
        ],
        choices:[
          {id:'c5', text:'هل تعيشين مع عائلتك؟'},
          {id:'c6', text:'من قال لك ذلك؟'}
        ]
      },
      {
        day:4,
        lines:[
          "الظلام هنا طويل...",
          "أحيانًا أرى ظلًا يشبهه... ولا أعرف اسمه."
        ],
        choices:[
          {id:'c7', text:'هل هذا الظل مؤذي؟'},
          {id:'c8', text:'ألا تريدين العودة للمنزل؟'}
        ]
      },
      {
        day:5,
        lines:[
          "أخيرًا... شعرت بشيء يشبه السلام لثوانٍ...",
          "هل يمكنك البقاء معي؟"
        ],
        choices:[
          {id:'c9', text:'سأبقى إلى أن تروِ كل شيء.'},
          {id:'c10', text:'أنتِ بحاجة لمساعدة حقيقية.'}
        ]
      }
    ];

    // ---------- إدارة التقدّم في localStorage ----------
    const KEY = 'maryam_progress_v1';
    const FAKE_NEXT_DAY = false; // للمطوّرين: ضعه true لتجاوز شرط 24 ساعة أثناء الاختبار

    function loadProgress(){
      try{
        const raw = localStorage.getItem(KEY);
        if(!raw) return {lastDay:0, lastSeenTs:0, choices:{}};
        return JSON.parse(raw);
      }catch(e){
        return {lastDay:0, lastSeenTs:0, choices:{}};
      }
    }
    function saveProgress(p){ localStorage.setItem(KEY, JSON.stringify(p)); }

    // تحقق إن كان يمكن الانتقال ليوم جديد
    function canAdvance(prevTs){
      if(FAKE_NEXT_DAY) return true;
      if(!prevTs) return true;
      const ms24 = 24*60*60*1000;
      return (Date.now() - prevTs) >= ms24;
    }

    // ---------- واجهة المستخدم ----------
    const dialogEl = document.getElementById('dialog');
    const choicesEl = document.getElementById('choices');
    const progressEl = document.getElementById('progress');

    let progress = loadProgress();

    function render(){
      dialogEl.innerHTML='';
      choicesEl.innerHTML='';

      const lastDay = progress.lastDay || 0;
      const nextDayIndex = Math.min(lastDay, STORY.length-1);
      // نعرض اليوم الحالي (أو المقدّم)
      const showDay = STORY[nextDayIndex];

      // نص ترحيبي قصير
      appendLine('مريم', showDay.lines[0]);

      // نعرض باقي الأسطر بالتدرج
      for(let i=1;i<showDay.lines.length;i++) appendLine('mariam', showDay.lines[i]);

      // عرض خيارات اليوم
      showDay.choices.forEach(ch => {
        const btn = document.createElement('button');
        btn.className='choice';
        btn.textContent = ch.text;
        btn.onclick = ()=>onChoose(showDay.day, ch.id);
        choicesEl.appendChild(btn);
      });

      // معلومات التقدّم
      const seenDate = progress.lastSeenTs ? new Date(progress.lastSeenTs).toLocaleString('ar-EG') : 'لم يُسجل بعد';
      progressEl.textContent = `يوم اللعبة: ${showDay.day} — آخر زيارة: ${seenDate}`;
    }

    function appendLine(who,text){
      const div = document.createElement('div');
      div.className = 'line ' + (who==='mariam'?'mariam':'player');
      div.textContent = text;
      dialogEl.appendChild(div);
      // تمرير تلقائي للمحتوى
      dialogEl.scrollTop = dialogEl.scrollHeight;
    }

    function onChoose(day,choiceId){
      // سجّل اختيار اللاعب
      progress.choices = progress.choices||{};
      progress.choices[`day${day}`] = choiceId;
      // سجّل وقت الزيارة
      const now = Date.now();
      progress.lastSeenTs = now;

      // اذا كان اللاعب في اخر يوم المتاح وسبق له زيارة اليوم، لا نزيد اليوم.
      if(progress.lastDay < STORY.length && canAdvance(progress._prevTs)){
        // زيادة المرحلة فقط إن وصل اللاعب لنهاية اليوم
        if(progress.lastDay < day) progress.lastDay = day;
        // لاحظ التاريخ السابق (لاستعمال canAdvance لاحقًا)
        progress._prevTs = now;
      }

      saveProgress(progress);

      // إظهار رد مريم بناءً على الاختيار (نسخة مبسطة)
      const shortReply = {
        'c1':'شكرًا... أعتقد أنني سأثق بك.',
        'c2':'اسمي مهم... لكن صوتك هو الأهم الآن.',
        'c3':'هم يعرفون أسماءنا قبل أن نعرفها.',
        'c4':'نعم. الخوف صديق قديم هنا.',
        'c5':'لا. لا أذكر وجوهًا واضحة.',
        'c6':'همسٌ خلف الباب... فقط همس.',
        'c7':'أحيانًا... أحيانًا يلمسني الظل.',
        'c8':'أريد، لكن الطريق كثير من الأقفال.',
        'c9':'ابقَ. سأحكي لك كل شيء بصوت منخفض.',
        'c10':'لا أعرف من أطلبه... ربما أنت.'
      }[choiceId] || '...';

      appendLine('player', document.querySelector(`button.choice:focus`)?.textContent || 'أجبت.');
      setTimeout(()=>appendLine('mariam', shortReply),600);

      // بعد اختيار، إن كان هناك يوم تالي ومرّ 24 ساعة - نخبر اللاعب
      const canNext = canAdvance(progress._prevTs);
      if(!canNext){
        const remain = (24*60*60*1000) - (Date.now() - (progress._prevTs||0));
        appendLine('mariam', 'عد غدًا لأكشف المزيد.');
      } else {
        // تقدّم إلى اليوم التالي إذا كان موجودًا
        if(progress.lastDay < STORY.length) {
          progress.lastDay = Math.min(progress.lastDay+1, STORY.length);
          progress._prevTs = Date.now();
          saveProgress(progress);
          appendLine('mariam', 'لقد انتقلتُ قليلاً في الذاكرة... ارجع غدًا إن أردت المزيد.');
        }
      }

      // تحديث العرض البسيط بعد تأخير
      setTimeout(render,900);
    }

    // إذا كانت هذه الزيارة الأولى: اضبط lastDay = 1
    if(!progress.lastDay){
      progress.lastDay = 1;
      progress._prevTs = progress.lastSeenTs || 0;
      saveProgress(progress);
    }

    // زر إعادة تعيين (للتطوير والاختبار) — يُعرض إذا ضغط المستخدم مع Shift
    window.addEventListener('keydown', (e)=>{
      if(e.key==='R' && (e.shiftKey||e.metaKey)){
        if(confirm('هل تريد مسح تقدم اللعبة؟')){
          localStorage.removeItem(KEY);
          progress = loadProgress();
          progress.lastDay = 1;
          saveProgress(progress);
          render();
        }
      }
    })

    // تشغيل العرض
    render();
  </script></body>
</html>
