<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„Ø¹Ø¨Ø© Ù…Ø±ÙŠÙ… â€” Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ÙˆØ³Ø¹Ø©</title>
  <style>
    :root {
      --bg: #0b0f12;
      --card: #0f1720;
      --accent: #e85d5d;
      --text: #e6eef6;
      --secondary: #9fb6d4;
      --success: #5de885;
      --warning: #e8c75d;
    }
    
    html, body {
      height: 100%;
      margin: 0;
      font-family: Tahoma, Arial, system-ui, Segoe UI, sans-serif;
      background: linear-gradient(180deg, #051018 0%, #08121a 60%);
      color: var(--text);
      overflow-x: hidden;
    }
    
    .wrap {
      min-height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .card {
      width: 100%;
      max-width: 900px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(2,6,23,0.7);
      border: 1px solid rgba(255,255,255,0.03);
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 20px;
    }
    
    header {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 10px;
    }
    
    .avatar {
      width: 96px;
      height: 96px;
      border-radius: 12px;
      background: linear-gradient(180deg, #222 0%, #111 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 46px;
      position: relative;
    }
    
    .avatar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 12px;
      background: linear-gradient(45deg, transparent, rgba(232, 93, 93, 0.2), transparent);
    }
    
    h1 {
      margin: 0;
      font-size: 20px;
    }
    
    p.lead {
      margin: 6px 0 12px;
      color: var(--secondary);
    }
    
    .main-content {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .dialog {
      background: rgba(255,255,255,0.02);
      padding: 16px;
      border-radius: 10px;
      min-height: 300px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .line {
      padding: 10px 12px;
      border-radius: 8px;
      max-width: 85%;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .line.mariam {
      background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      align-self: flex-start;
      border-right: 2px solid var(--accent);
    }
    
    .line.player {
      background: rgba(255,255,255,0.02);
      align-self: flex-end;
      border-left: 2px solid var(--secondary);
    }
    
    .choices {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: auto;
    }
    
    button.choice {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.06);
      padding: 10px 14px;
      border-radius: 8px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    button.choice:hover {
      border-color: var(--accent);
      background: rgba(232, 93, 93, 0.1);
    }
    
    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .panel {
      background: rgba(255,255,255,0.02);
      border-radius: 10px;
      padding: 15px;
      border: 1px solid rgba(255,255,255,0.03);
    }
    
    .panel h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 16px;
      color: var(--accent);
      border-bottom: 1px solid rgba(255,255,255,0.05);
      padding-bottom: 5px;
    }
    
    .stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .stat {
      text-align: center;
      padding: 8px;
      background: rgba(0,0,0,0.2);
      border-radius: 6px;
    }
    
    .stat-value {
      font-size: 18px;
      font-weight: bold;
      color: var(--accent);
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--secondary);
    }
    
    .inventory {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .item {
      width: 40px;
      height: 40px;
      background: rgba(0,0,0,0.3);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    .achievements {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .achievement {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      background: rgba(0,0,0,0.2);
      border-radius: 6px;
      font-size: 13px;
    }
    
    .achievement.locked {
      opacity: 0.5;
    }
    
    .achievement-icon {
      width: 24px;
      height: 24px;
      background: var(--accent);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    
    .achievement.locked .achievement-icon {
      background: var(--secondary);
    }
    
    footer {
      grid-column: 1 / -1;
      margin-top: 12px;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .hint {
      color: var(--secondary);
      font-size: 13px;
    }
    
    .meta {
      margin-left: auto;
      color: var(--secondary);
      font-size: 13px;
    }
    
    .hidden {
      display: none;
    }
    
    .chapter-title {
      text-align: center;
      padding: 10px;
      background: rgba(232, 93, 93, 0.1);
      border-radius: 8px;
      margin-bottom: 10px;
      border: 1px solid rgba(232, 93, 93, 0.2);
    }
    
    .progress-bar {
      height: 6px;
      background: rgba(255,255,255,0.05);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 5px;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--accent);
      border-radius: 3px;
      transition: width 0.5s ease;
    }
    
    /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø®Ø§ØµØ© */
    .glow {
      animation: glow 2s infinite alternate;
    }
    
    @keyframes glow {
      from { box-shadow: 0 0 5px rgba(232, 93, 93, 0.5); }
      to { box-shadow: 0 0 15px rgba(232, 93, 93, 0.8); }
    }
    
    /* small responsive */
    @media (max-width: 768px) {
      .card {
        grid-template-columns: 1fr;
      }
      
      .avatar {
        width: 72px;
        height: 72px;
        font-size: 34px;
      }
      
      .dialog {
        min-height: 250px;
        max-height: 300px;
      }
      
      .sidebar {
        order: -1;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="application" aria-label="Ù„Ø¹Ø¨Ø© Ù…Ø±ÙŠÙ… Ø§Ù„Ù…ÙˆØ³Ø¹Ø©">
      <header>
        <div class="avatar">Ù…</div>
        <div>
          <h1>Ù„Ø¹Ø¨Ø© Ù…Ø±ÙŠÙ… â€” Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ÙˆØ³Ø¹Ø©</h1>
          <p class="lead">Ø±Ø­Ù„Ø© ØºØ§Ù…Ø¶Ø© ÙÙŠ Ø¹Ø§Ù„Ù… Ù…Ù† Ø§Ù„Ø£Ø³Ø±Ø§Ø±. Ø§ÙƒØªØ´Ù Ù‚ØµØ© Ù…Ø±ÙŠÙ… ÙˆØ§Ø³ØªÙƒØ´Ù Ø¹ÙˆØ§Ù„Ù… Ù…ØªØ¹Ø¯Ø¯Ø©.</p>
          <div class="meta">Ù†Ø³Ø®Ø© Ù…ÙˆØ³Ø¹Ø© â€” ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙØµÙˆÙ„ Ù…ØªØ¹Ø¯Ø¯Ø© ÙˆØ£Ù†Ø¸Ù…Ø© ØªÙØ§Ø¹Ù„ÙŠØ©</div>
        </div>
      </header>
      
      <main class="main-content">
        <div id="chapterTitle" class="chapter-title">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</div>
        <div id="dialog" class="dialog" aria-live="polite"></div>
        <div id="choices" class="choices"></div>
      </main>
      
      <aside class="sidebar">
        <div class="panel">
          <h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h3>
          <div class="stats">
            <div class="stat">
              <div class="stat-value" id="statDays">1</div>
              <div class="stat-label">ÙŠÙˆÙ…</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="statChapters">1</div>
              <div class="stat-label">ÙØµÙ„</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="statChoices">0</div>
              <div class="stat-label">Ø§Ø®ØªÙŠØ§Ø±</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="statSecrets">0</div>
              <div class="stat-label">Ø³Ø±</div>
            </div>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 5%"></div>
          </div>
        </div>
        
        <div class="panel">
          <h3>Ø§Ù„Ø¬Ø±Ø¯</h3>
          <div class="inventory" id="inventory">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
          </div>
        </div>
        
        <div class="panel">
          <h3>Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</h3>
          <div class="achievements" id="achievements">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
          </div>
        </div>
      </aside>
      
      <footer>
        <div class="hint">Ù†ØµÙŠØ­Ø©: Ø§Ø³ØªÙƒØ´Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ù„Ø§ÙƒØªØ´Ø§Ù Ù†Ù‡Ø§ÙŠØ§Øª Ù…Ø®ØªÙ„ÙØ© ÙˆØ£Ø³Ø±Ø§Ø± Ù…Ø®ÙÙŠØ©.</div>
        <div class="meta" id="progress"></div>
      </footer>
    </div>
  </div>

  <script>
    // ---------- Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ³Ø¹Ø© Ù„Ù„Ø¹Ø¨Ø© ----------
    
    // Ù†Ø¸Ø§Ù… Ø§Ù„ÙØµÙˆÙ„
    const CHAPTERS = [
      {
        id: 1,
        title: "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©",
        days: [
          {
            day: 1,
            lines: [
              "...",
              "Ø£Ù†Ø§ Ù…Ø±ÙŠÙ…. Ù‡Ù„ Ø³ØªØ³Ø§Ø¹Ø¯Ù†ÙŠØŸ",
              "Ù„Ù‚Ø¯ Ø¶Ø¹Øª ÙÙŠ Ø§Ù„ØºØ§Ø¨Ø©."
            ],
            choices: [
              {id: 'c1', text: 'Ù†Ø¹Ù…ØŒ Ø³Ø£Ø³Ø§Ø¹Ø¯Ùƒ.'},
              {id: 'c2', text: 'Ù…Ù† Ø£Ù†ØªØŸ'},
              {id: 'c3', text: 'Ø£ÙŠÙ† Ù†Ø­Ù†ØŸ'}
            ]
          },
          {
            day: 2,
            lines: [
              "Ø§Ù„ÙŠÙˆÙ… ÙŠØ¨Ø¯Ùˆ Ù…Ø®ØªÙ„ÙÙ‹Ø§.",
              "Ø£Ø³Ù…Ø¹ Ø£ØµÙˆØ§ØªÙ‹Ø§ØŒ Ù„ÙƒÙ† Ù„Ø§ Ø£Ø­Ø¯ ÙŠØ±Ø¯ Ø¹Ù„ÙŠÙ‘."
            ],
            choices: [
              {id: 'c4', text: 'Ù…Ø§ Ø§Ù„Ø°ÙŠ Ø­Ø¯Ø« Ù„ÙƒØŸ'},
              {id: 'c5', text: 'Ù‡Ù„ Ø£Ù†Øª Ø®Ø§Ø¦ÙØ©ØŸ'},
              {id: 'c6', text: 'Ù‡Ù„ ØªØ³Ù…Ø¹ÙŠÙ† Ø´ÙŠØ¦Ù‹Ø§ Ø§Ù„Ø¢Ù†ØŸ'}
            ]
          },
          {
            day: 3,
            lines: [
              "Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ Ø£ØªØ°ÙƒÙ‘Ø± Ø£Ø¨ÙˆØ§Ø¨Ù‹Ø§ ØªÙØºÙ„ÙÙ‚...",
              "ÙˆÙ‚Ø§Ù„ÙˆØ§ Ù„ÙŠ: Ù„Ø§ ØªØ®Ø±Ø¬ÙŠ ÙˆØ­Ø¯Ùƒ."
            ],
            choices: [
              {id: 'c7', text: 'Ù‡Ù„ ØªØ¹ÙŠØ´ÙŠÙ† Ù…Ø¹ Ø¹Ø§Ø¦Ù„ØªÙƒØŸ'},
              {id: 'c8', text: 'Ù…Ù† Ù‚Ø§Ù„ Ù„Ùƒ Ø°Ù„ÙƒØŸ'},
              {id: 'c9', text: 'Ù„Ù…Ø§Ø°Ø§ Ù„Ø§ ÙŠØ¬Ø¨ Ø£Ù† ØªØ®Ø±Ø¬ÙŠ ÙˆØ­Ø¯ÙƒØŸ'}
            ]
          }
        ]
      },
      {
        id: 2,
        title: "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø¸Ù„Ø§Ù„",
        days: [
          {
            day: 4,
            lines: [
              "Ø§Ù„Ø¸Ù„Ø§Ù… Ù‡Ù†Ø§ Ø·ÙˆÙŠÙ„...",
              "Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ Ø£Ø±Ù‰ Ø¸Ù„Ù‹Ø§ ÙŠØ´Ø¨Ù‡Ù‡... ÙˆÙ„Ø§ Ø£Ø¹Ø±Ù Ø§Ø³Ù…Ù‡."
            ],
            choices: [
              {id: 'c10', text: 'Ù‡Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¸Ù„ Ù…Ø¤Ø°ÙŠØŸ'},
              {id: 'c11', text: 'Ø£Ù„Ø§ ØªØ±ÙŠØ¯ÙŠÙ† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù†Ø²Ù„ØŸ'},
              {id: 'c12', text: 'ØµÙ Ù„ÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¸Ù„.'}
            ]
          },
          {
            day: 5,
            lines: [
              "Ø£Ø®ÙŠØ±Ù‹Ø§... Ø´Ø¹Ø±Øª Ø¨Ø´ÙŠØ¡ ÙŠØ´Ø¨Ù‡ Ø§Ù„Ø³Ù„Ø§Ù… Ù„Ø«ÙˆØ§Ù†Ù...",
              "Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ù‚Ø§Ø¡ Ù…Ø¹ÙŠØŸ"
            ],
            choices: [
              {id: 'c13', text: 'Ø³Ø£Ø¨Ù‚Ù‰ Ø¥Ù„Ù‰ Ø£Ù† ØªØ±ÙˆÙ ÙƒÙ„ Ø´ÙŠØ¡.'},
              {id: 'c14', text: 'Ø£Ù†ØªÙ Ø¨Ø­Ø§Ø¬Ø© Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ©.'},
              {id: 'c15', text: 'Ù‡Ù„ Ù‡Ù†Ø§Ùƒ Ø´ÙŠØ¡ ÙŠÙ…ÙƒÙ†Ù†ÙŠ ÙØ¹Ù„Ù‡ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ'}
            ]
          },
          {
            day: 6,
            lines: [
              "Ø§Ù„Ø¸Ù„ Ø£ØµØ¨Ø­ Ø£Ù‚Ø±Ø¨...",
              "Ø£Ø¹ØªÙ‚Ø¯ Ø£Ù†Ù‡ ÙŠØ­Ø§ÙˆÙ„ Ø¥Ø®Ø¨Ø§Ø±ÙŠ Ø¨Ø´ÙŠØ¡."
            ],
            choices: [
              {id: 'c16', text: 'Ù…Ø§Ø°Ø§ ÙŠÙ‚ÙˆÙ„ Ø§Ù„Ø¸Ù„ØŸ'},
              {id: 'c17', text: 'Ù‡Ù„ ÙŠØ¬Ø¨ Ø£Ù† Ù†Ø®Ø§Ù Ù…Ù†Ù‡ØŸ'},
              {id: 'c18', text: 'Ø­Ø§ÙˆÙ„ÙŠ Ø§Ù„ØªØ­Ø¯Ø« Ù…Ø¹Ù‡.'}
            ]
          }
        ]
      },
      {
        id: 3,
        title: "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª",
        days: [
          {
            day: 7,
            lines: [
              "Ø§Ù„ÙŠÙˆÙ… Ø£ØªØ°ÙƒØ± Ø´ÙŠØ¦Ù‹Ø§...",
              "ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ù†Ø²Ù„ Ø£Ø¨ÙŠØ¶ ÙˆØ¨Ø§Ø¨ Ø£Ø²Ø±Ù‚."
            ],
            choices: [
              {id: 'c19', text: 'Ù‡Ù„ Ù‡Ø°Ø§ Ù…Ù†Ø²Ù„ÙƒØŸ'},
              {id: 'c20', text: 'Ù…Ø§Ø°Ø§ ÙŠÙˆØ¬Ø¯ Ø®Ù„Ù Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø£Ø²Ø±Ù‚ØŸ'},
              {id: 'c21', text: 'Ù‡Ù„ ØªØ°ÙƒØ±ÙŠÙ† Ù…Ù† ÙƒØ§Ù† ÙŠØ¹ÙŠØ´ Ù…Ø¹ÙƒØŸ'}
            ]
          },
          {
            day: 8,
            lines: [
              "Ø£ØªØ°ÙƒØ± Ø§Ù…Ø±Ø£Ø©... ÙƒØ§Ù†Øª ØªØºÙ†ÙŠ Ù„ÙŠ.",
              "Ù„ÙƒÙ† ÙˆØ¬Ù‡Ù‡Ø§ ØºÙŠØ± ÙˆØ§Ø¶Ø­."
            ],
            choices: [
              {id: 'c22', text: 'Ù‡Ù„ ÙƒØ§Ù†Øª Ø£Ù…ÙƒØŸ'},
              {id: 'c23', text: 'Ù…Ø§Ø°Ø§ ÙƒØ§Ù†Øª ØªØºÙ†ÙŠØŸ'},
              {id: 'c24', text: 'Ù„Ù…Ø§Ø°Ø§ Ù„Ø§ ØªØ³ØªØ·ÙŠØ¹ÙŠÙ† Ø±Ø¤ÙŠØ© ÙˆØ¬Ù‡Ù‡Ø§ØŸ'}
            ]
          }
        ]
      }
      // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ÙØµÙˆÙ„ Ù‡Ù†Ø§
    ];

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø±Ø¯
    const ITEMS = {
      'Ù…ÙØªØ§Ø­': { name: 'Ù…ÙØªØ§Ø­ Ù‚Ø¯ÙŠÙ…', description: 'Ù…ÙØªØ§Ø­ ØµØ¯Ø¦ Ù‚Ø¯ ÙŠÙØªØ­ Ø´ÙŠØ¦Ù‹Ø§ Ù…Ù‡Ù…Ù‹Ø§', icon: 'ğŸ”‘' },
      'ÙˆØ±Ù‚Ø©': { name: 'ÙˆØ±Ù‚Ø© Ù…Ù…Ø²Ù‚Ø©', description: 'ÙˆØ±Ù‚Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒØªØ§Ø¨Ø© ØºÙŠØ± ÙˆØ§Ø¶Ø­Ø©', icon: 'ğŸ“œ' },
      'Ø´Ø¹Ù„Ø©': { name: 'Ø´Ø¹Ù„Ø©', description: 'ØªÙ†ÙŠØ± Ø§Ù„Ø·Ø±ÙŠÙ‚ ÙÙŠ Ø§Ù„Ø¸Ù„Ø§Ù…', icon: 'ğŸ”¦' },
      'ÙƒØªØ§Ø¨': { name: 'ÙƒØªØ§Ø¨ Ø£Ø³ÙˆØ¯', description: 'ÙƒØªØ§Ø¨ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ù…ÙˆØ² ØºØ±ÙŠØ¨Ø©', icon: 'ğŸ“–' }
    };

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª
    const ACHIEVEMENTS = [
      { id: 'ach1', name: 'Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©', description: 'Ø£ÙƒÙ…Ù„ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„', icon: 'ğŸŒŸ', unlocked: false },
      { id: 'ach2', name: 'Ø§Ù„Ù…Ø³ØªÙƒØ´Ù', description: 'Ø§Ø®ØªØ§Ø± 10 Ø®ÙŠØ§Ø±Ø§Øª Ù…Ø®ØªÙ„ÙØ©', icon: 'ğŸ§­', unlocked: false },
      { id: 'ach3', name: 'Ø¬Ø§Ù…Ø¹ Ø§Ù„Ø£Ø³Ø±Ø§Ø±', description: 'Ø§Ø¬Ù…Ø¹ 3 Ø¹Ù†Ø§ØµØ±', icon: 'ğŸ—ï¸', unlocked: false },
      { id: 'ach4', name: 'ØµØ¯ÙŠÙ‚ Ù…Ø±ÙŠÙ…', description: 'Ø£ÙƒÙ…Ù„ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„', icon: 'ğŸ¤', unlocked: false },
      { id: 'ach5', name: 'Ø¨Ø·Ù„ Ø§Ù„Ù‚ØµØ©', description: 'Ø£ÙƒÙ…Ù„ 3 ÙØµÙˆÙ„', icon: 'ğŸ†', unlocked: false }
    ];

    // ---------- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø¯Ù‘Ù… ÙÙŠ localStorage ----------
    const KEY = 'maryam_extended_progress_v1';
    const FAKE_NEXT_DAY = false; // Ù„Ù„Ù…Ø·ÙˆÙ‘Ø±ÙŠÙ†: Ø¶Ø¹Ù‡ true Ù„ØªØ¬Ø§ÙˆØ² Ø´Ø±Ø· 24 Ø³Ø§Ø¹Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±

    function loadProgress() {
      try {
        const raw = localStorage.getItem(KEY);
        if (!raw) return {
          currentChapter: 1,
          currentDay: 1,
          lastSeenTs: 0,
          choices: {},
          inventory: [],
          achievements: ACHIEVEMENTS.map(a => ({...a, unlocked: false})),
          stats: {
            daysCompleted: 1,
            choicesMade: 0,
            secretsFound: 0
          }
        };
        return JSON.parse(raw);
      } catch (e) {
        return {
          currentChapter: 1,
          currentDay: 1,
          lastSeenTs: 0,
          choices: {},
          inventory: [],
          achievements: ACHIEVEMENTS.map(a => ({...a, unlocked: false})),
          stats: {
            daysCompleted: 1,
            choicesMade: 0,
            secretsFound: 0
          }
        };
      }
    }

    function saveProgress(p) {
      localStorage.setItem(KEY, JSON.stringify(p));
    }

    // ØªØ­Ù‚Ù‚ Ø¥Ù† ÙƒØ§Ù† ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯
    function canAdvance(prevTs) {
      if (FAKE_NEXT_DAY) return true;
      if (!prevTs) return true;
      const ms24 = 24 * 60 * 60 * 1000;
      return (Date.now() - prevTs) >= ms24;
    }

    // ---------- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ----------
    const dialogEl = document.getElementById('dialog');
    const choicesEl = document.getElementById('choices');
    const progressEl = document.getElementById('progress');
    const chapterTitleEl = document.getElementById('chapterTitle');
    const inventoryEl = document.getElementById('inventory');
    const achievementsEl = document.getElementById('achievements');
    const statDaysEl = document.getElementById('statDays');
    const statChaptersEl = document.getElementById('statChapters');
    const statChoicesEl = document.getElementById('statChoices');
    const statSecretsEl = document.getElementById('statSecrets');
    const progressFillEl = document.getElementById('progressFill');

    let progress = loadProgress();

    function render() {
      dialogEl.innerHTML = '';
      choicesEl.innerHTML = '';

      const currentChapter = CHAPTERS.find(c => c.id === progress.currentChapter) || CHAPTERS[0];
      const currentDay = currentChapter.days.find(d => d.day === progress.currentDay) || currentChapter.days[0];

      // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØµÙ„
      chapterTitleEl.textContent = currentChapter.title;

      // Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙŠÙˆÙ…
      appendLine('mariam', currentDay.lines[0]);
      
      for (let i = 1; i < currentDay.lines.length; i++) {
        appendLine('mariam', currentDay.lines[i]);
      }

      // Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…
      currentDay.choices.forEach(ch => {
        const btn = document.createElement('button');
        btn.className = 'choice';
        btn.textContent = ch.text;
        btn.onclick = () => onChoose(currentChapter.id, currentDay.day, ch.id);
        choicesEl.appendChild(btn);
      });

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      updateStats();
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø±Ø¯
      updateInventory();
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª
      updateAchievements();
      
      // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
      updateProgressBar();

      // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…
      const seenDate = progress.lastSeenTs ? new Date(progress.lastSeenTs).toLocaleString('ar-EG') : 'Ù„Ù… ÙŠÙØ³Ø¬Ù„ Ø¨Ø¹Ø¯';
      progressEl.textContent = `Ø§Ù„ÙØµÙ„: ${progress.currentChapter} - Ø§Ù„ÙŠÙˆÙ…: ${progress.currentDay} - Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©: ${seenDate}`;
    }

    function appendLine(who, text) {
      const div = document.createElement('div');
      div.className = 'line ' + (who === 'mariam' ? 'mariam' : 'player');
      div.textContent = text;
      dialogEl.appendChild(div);
      // ØªÙ…Ø±ÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø­ØªÙˆÙ‰
      dialogEl.scrollTop = dialogEl.scrollHeight;
    }

    function updateStats() {
      statDaysEl.textContent = progress.stats.daysCompleted;
      statChaptersEl.textContent = progress.currentChapter;
      statChoicesEl.textContent = progress.stats.choicesMade;
      statSecretsEl.textContent = progress.stats.secretsFound;
    }

    function updateInventory() {
      inventoryEl.innerHTML = '';
      
      if (progress.inventory.length === 0) {
        const emptyMsg = document.createElement('div');
        emptyMsg.textContent = 'Ø§Ù„Ø¬Ø±Ø¯ ÙØ§Ø±Øº';
        emptyMsg.style.color = 'var(--secondary)';
        emptyMsg.style.fontSize = '13px';
        inventoryEl.appendChild(emptyMsg);
        return;
      }
      
      progress.inventory.forEach(itemKey => {
        const item = ITEMS[itemKey];
        if (item) {
          const itemEl = document.createElement('div');
          itemEl.className = 'item';
          itemEl.title = item.description;
          itemEl.textContent = item.icon;
          inventoryEl.appendChild(itemEl);
        }
      });
    }

    function updateAchievements() {
      achievementsEl.innerHTML = '';
      
      progress.achievements.forEach(ach => {
        const achEl = document.createElement('div');
        achEl.className = `achievement ${ach.unlocked ? '' : 'locked'}`;
        
        const icon = document.createElement('div');
        icon.className = 'achievement-icon';
        icon.textContent = ach.icon;
        
        const text = document.createElement('div');
        text.innerHTML = `<strong>${ach.name}</strong><br><small>${ach.description}</small>`;
        
        achEl.appendChild(icon);
        achEl.appendChild(text);
        achievementsEl.appendChild(achEl);
      });
    }

    function updateProgressBar() {
      const totalDays = CHAPTERS.reduce((sum, chapter) => sum + chapter.days.length, 0);
      const completedDays = progress.stats.daysCompleted;
      const progressPercent = (completedDays / totalDays) * 100;
      progressFillEl.style.width = `${Math.min(progressPercent, 100)}%`;
    }

    function onChoose(chapterId, day, choiceId) {
      // Ø³Ø¬Ù‘Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨
      progress.choices = progress.choices || {};
      progress.choices[`ch${chapterId}d${day}`] = choiceId;
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      progress.stats.choicesMade++;
      
      // Ø³Ø¬Ù‘Ù„ ÙˆÙ‚Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø©
      const now = Date.now();
      progress.lastSeenTs = now;

      // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨
      appendLine('player', document.querySelector(`button.choice:focus`)?.textContent || 'Ø£Ø¬Ø¨Øª.');

      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø¯ Ù…Ø±ÙŠÙ…
      const reply = getMariamReply(choiceId);
      
      setTimeout(() => {
        appendLine('mariam', reply.text);
        
        // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙˆØ§Ø­Ø¯
        if (reply.item && !progress.inventory.includes(reply.item)) {
          progress.inventory.push(reply.item);
          setTimeout(() => {
            appendLine('system', `Ù„Ù‚Ø¯ Ø­ØµÙ„Øª Ø¹Ù„Ù‰: ${ITEMS[reply.item].name}`);
          }, 600);
        }
        
        // ÙØªØ­ Ø¥Ù†Ø¬Ø§Ø² Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙˆØ§Ø­Ø¯
        if (reply.achievement) {
          const ach = progress.achievements.find(a => a.id === reply.achievement);
          if (ach && !ach.unlocked) {
            ach.unlocked = true;
            setTimeout(() => {
              appendLine('system', `Ø¥Ù†Ø¬Ø§Ø² Ù…ÙØªÙˆØ­: ${ach.name}`);
              achEl = document.querySelector(`.achievement:last-child`);
              if (achEl) achEl.classList.add('glow');
            }, 900);
          }
        }
        
        // Ø§Ù„ØªÙ‚Ø¯Ù… Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø°Ù„Ùƒ Ù…Ù…ÙƒÙ†Ø§Ù‹
        setTimeout(() => {
          advanceIfPossible();
        }, 1200);
      }, 600);

      saveProgress(progress);
    }

    function getMariamReply(choiceId) {
      const replies = {
        'c1': { text: 'Ø´ÙƒØ±Ù‹Ø§... Ø£Ø¹ØªÙ‚Ø¯ Ø£Ù†Ù†ÙŠ Ø³Ø£Ø«Ù‚ Ø¨Ùƒ.' },
        'c2': { text: 'Ø§Ø³Ù…ÙŠ Ù…Ù‡Ù…... Ù„ÙƒÙ† ØµÙˆØªÙƒ Ù‡Ùˆ Ø§Ù„Ø£Ù‡Ù… Ø§Ù„Ø¢Ù†.' },
        'c3': { text: 'Ù„Ø§ Ø£Ø¹Ø±Ù Ø¨Ø§Ù„Ø¶Ø¨Ø·. ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØ¨Ø¯Ùˆ Ø¶Ø¨Ø§Ø¨ÙŠÙ‹Ø§.' },
        'c4': { text: 'Ù‡Ù… ÙŠØ¹Ø±ÙÙˆÙ† Ø£Ø³Ù…Ø§Ø¡Ù†Ø§ Ù‚Ø¨Ù„ Ø£Ù† Ù†Ø¹Ø±ÙÙ‡Ø§.' },
        'c5': { text: 'Ù†Ø¹Ù…. Ø§Ù„Ø®ÙˆÙ ØµØ¯ÙŠÙ‚ Ù‚Ø¯ÙŠÙ… Ù‡Ù†Ø§.' },
        'c6': { text: 'Ù†Ø¹Ù…... ÙŠØ¨Ø¯Ùˆ ÙˆÙƒØ£Ù†Ù‡ Ù‡Ù…Ø³Ø§Øª Ø¨Ø¹ÙŠØ¯Ø©.' },
        'c7': { text: 'Ù„Ø§. Ù„Ø§ Ø£Ø°ÙƒØ± ÙˆØ¬ÙˆÙ‡Ù‹Ø§ ÙˆØ§Ø¶Ø­Ø©.' },
        'c8': { text: 'Ù‡Ù…Ø³ÙŒ Ø®Ù„Ù Ø§Ù„Ø¨Ø§Ø¨... ÙÙ‚Ø· Ù‡Ù…Ø³.' },
        'c9': { text: 'Ù„Ø§ Ø£Ø¹Ø±Ù... Ù„ÙƒÙ† ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø± Ù…Ø§.' },
        'c10': { text: 'Ø£Ø­ÙŠØ§Ù†Ù‹Ø§... Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ ÙŠÙ„Ù…Ø³Ù†ÙŠ Ø§Ù„Ø¸Ù„.', item: 'Ø´Ø¹Ù„Ø©' },
        'c11': { text: 'Ø£Ø±ÙŠØ¯ØŒ Ù„ÙƒÙ† Ø§Ù„Ø·Ø±ÙŠÙ‚ ÙƒØ«ÙŠØ± Ù…Ù† Ø§Ù„Ø£Ù‚ÙØ§Ù„.' },
        'c12': { text: 'Ø·ÙˆÙŠÙ„... ÙˆÙ…Ø¸Ù„Ù…... Ù„ÙƒÙ† Ø¹ÙŠÙ†Ø§Ù‡ ØªÙ„Ù…Ø¹Ø§Ù†.' },
        'c13': { text: 'Ø§Ø¨Ù‚Ù. Ø³Ø£Ø­ÙƒÙŠ Ù„Ùƒ ÙƒÙ„ Ø´ÙŠØ¡ Ø¨ØµÙˆØª Ù…Ù†Ø®ÙØ¶.', achievement: 'ach4' },
        'c14': { text: 'Ù„Ø§ Ø£Ø¹Ø±Ù Ù…Ù† Ø£Ø·Ù„Ø¨Ù‡... Ø±Ø¨Ù…Ø§ Ø£Ù†Øª.' },
        'c15': { text: 'Ø±Ø¨Ù…Ø§... Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª Ø§Ù„Ù…ÙØªØ§Ø­.' },
        'c16': { text: 'Ø¥Ù†Ù‡ ÙŠÙ‚ÙˆÙ„ ÙƒÙ„Ù…Ø§Øª Ù„Ø§ Ø£ÙÙ‡Ù…Ù‡Ø§... Ù„ÙƒÙ†Ù‡Ø§ ØªØ°ÙƒØ±Ù†ÙŠ Ø¨Ø´ÙŠØ¡.' },
        'c17': { text: 'Ù„Ø§ Ø£Ø¹ØªÙ‚Ø¯ Ø°Ù„Ùƒ... Ù„ÙƒÙ†Ù‡ ÙŠØ­Ù…Ù„ Ø³Ø±Ù‹Ø§.' },
        'c18': { text: 'Ø³Ø£Ø­Ø§ÙˆÙ„... Ø¥Ù†Ù‡ ÙŠÙ‚ØªØ±Ø¨ Ø§Ù„Ø¢Ù†.' },
        'c19': { text: 'Ø£Ø¹ØªÙ‚Ø¯ Ø°Ù„Ùƒ... Ù„ÙƒÙ† Ù„Ø§ Ø£ØªØ°ÙƒØ± ÙƒÙŠÙ ÙˆØµÙ„Øª Ø¥Ù„Ù‰ Ù‡Ù†Ø§.' },
        'c20': { text: 'Ø´ÙŠØ¡ Ù…Ù‡Ù…... Ø´ÙŠØ¡ Ù†Ø³ÙŠØªÙÙ‡.', item: 'Ù…ÙØªØ§Ø­' },
        'c21': { text: 'Ø§Ù…Ø±Ø£Ø©... ÙˆØ±Ø¬Ù„... ÙˆØ·ÙÙ„ Ø¢Ø®Ø±.' },
        'c22': { text: 'Ù†Ø¹Ù…... Ø£Ø¹ØªÙ‚Ø¯ Ø°Ù„Ùƒ. ÙƒØ§Ù†Øª Ø¯Ø§ÙØ¦Ø©.' },
        'c23': { text: 'Ø£ØºÙ†ÙŠØ© Ø¹Ù† Ø§Ù„Ù†Ø¬ÙˆÙ…... ÙˆØ§Ù„Ø¨Ø­Ø§Ø± Ø§Ù„Ø¨Ø¹ÙŠØ¯Ø©.' },
        'c24': { text: 'ÙƒØ£Ù† Ù‡Ù†Ø§Ùƒ Ø¶Ø¨Ø§Ø¨Ù‹Ø§ ÙŠØºØ·ÙŠ Ø°Ø§ÙƒØ±ØªÙŠ.' }
      };
      
      return replies[choiceId] || { text: '...' };
    }

    function advanceIfPossible() {
      const currentChapter = CHAPTERS.find(c => c.id === progress.currentChapter);
      if (!currentChapter) return;
      
      const currentDayIndex = currentChapter.days.findIndex(d => d.day === progress.currentDay);
      
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ÙŠÙˆÙ… ØªØ§Ù„ÙŠ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙØµÙ„
      if (currentDayIndex < currentChapter.days.length - 1) {
        if (canAdvance(progress._prevTs)) {
          progress.currentDay = currentChapter.days[currentDayIndex + 1].day;
          progress.stats.daysCompleted++;
          progress._prevTs = Date.now();
          saveProgress(progress);
          
          setTimeout(() => {
            appendLine('mariam', 'Ù„Ù‚Ø¯ Ø§Ù†ØªÙ‚Ù„ØªÙ Ù‚Ù„ÙŠÙ„Ø§Ù‹ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©... Ø¹Ø¯ ØºØ¯Ù‹Ø§ Ù„Ù„Ù…Ø²ÙŠØ¯.');
            setTimeout(render, 1000);
          }, 800);
        } else {
          const remain = (24 * 60 * 60 * 1000) - (Date.now() - (progress._prevTs || 0));
          appendLine('mariam', 'Ø¹Ø¯ ØºØ¯Ù‹Ø§ Ù„Ø£ÙƒØ´Ù Ø§Ù„Ù…Ø²ÙŠØ¯.');
        }
      } 
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ø°Ø§ Ø¢Ø®Ø± ÙŠÙˆÙ… ÙÙŠ Ø§Ù„ÙØµÙ„ ÙˆÙ‡Ù†Ø§Ùƒ ÙØµÙ„ ØªØ§Ù„ÙŠ
      else if (progress.currentChapter < CHAPTERS.length) {
        if (canAdvance(progress._prevTs)) {
          progress.currentChapter++;
          progress.currentDay = 1;
          progress.stats.daysCompleted++;
          progress._prevTs = Date.now();
          saveProgress(progress);
          
          setTimeout(() => {
            appendLine('mariam', 'Ù„Ù‚Ø¯ Ø¯Ø®Ù„Ù†Ø§ Ø¥Ù„Ù‰ ÙØµÙ„ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù‚ØµØ©... Ø§Ø³ØªØ¹Ø¯ Ù„Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù…Ø²ÙŠØ¯.');
            setTimeout(render, 1000);
          }, 800);
        } else {
          appendLine('mariam', 'Ø¹Ø¯ ØºØ¯Ù‹Ø§ Ù„ØªØ¨Ø¯Ø£ ÙØµÙ„Ù‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§.');
        }
      } 
      // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© (Ù…Ø¤Ù‚ØªØ©)
      else {
        appendLine('mariam', 'Ø´ÙƒØ±Ù‹Ø§ Ù„Ø¨Ù‚Ø§Ø¦Ùƒ Ù…Ø¹ÙŠ... Ù‡Ø°Ù‡ Ù†Ù‡Ø§ÙŠØ© Ø±Ø­Ù„ØªÙ†Ø§ Ø­Ø§Ù„ÙŠÙ‹Ø§.');
      }
    }

    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ø°Ù‡ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
    if (!progress.currentDay) {
      progress.currentChapter = 1;
      progress.currentDay = 1;
      progress._prevTs = progress.lastSeenTs || 0;
      progress.stats.daysCompleted = 1;
      saveProgress(progress);
    }

    // ÙØªØ­ Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„
    if (progress.currentDay === 1 && progress.currentChapter === 1) {
      const startAch = progress.achievements.find(a => a.id === 'ach1');
      if (startAch && !startAch.unlocked) {
        startAch.unlocked = true;
      }
    }

    // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† (Ù„Ù„ØªØ·ÙˆÙŠØ± ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±)
    window.addEventListener('keydown', (e) => {
      if (e.key === 'R' && (e.shiftKey || e.metaKey)) {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ØªÙ‚Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨Ø©ØŸ')) {
          localStorage.removeItem(KEY);
          progress = loadProgress();
          progress.currentChapter = 1;
          progress.currentDay = 1;
          saveProgress(progress);
          render();
        }
      }
    });

    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶
    render();
  </script>
</body>
</html>
